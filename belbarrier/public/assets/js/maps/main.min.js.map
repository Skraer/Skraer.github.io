{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["class GateForm {\r\n    constructor(selector, {onSubmit, onIncorrect, formSelector}) {\r\n        this.selector = selector;\r\n        this.el = document.querySelector(selector);\r\n        this.btn = this.el.querySelector('.gate-form__submit');\r\n        this.onSubmit = onSubmit || function(){};\r\n        this.onIncorrect = onIncorrect || function(){alert('Выбраны не все значения!')};\r\n        this.form = document.querySelector(formSelector);\r\n        this.mainImg = [\r\n            this.el.querySelector('.gate-form__img img').getAttribute('src'),\r\n            this.el.querySelector('.gate-form__img img').getAttribute('data-src')\r\n        ];\r\n        \r\n        this.setup();\r\n    }\r\n    getFormData() {\r\n        const inputs = this.el.querySelectorAll('input');\r\n        // const names = new Set();\r\n        const data = {};\r\n        let allow = true;\r\n        inputs.forEach(input => {\r\n            const name = input.getAttribute('name');\r\n            // names.add(name);\r\n            \r\n            if ((input.getAttribute('type') === 'checkbox' || input.getAttribute('type') === 'radio') && input.checked) {\r\n                data[name] = data[name] ? \r\n                    data[name] + ', ' + input.value : \r\n                    input.value;\r\n                // data[name] = input.value;\r\n            } else if ((input.getAttribute('type') === 'number' || input.getAttribute('type') === 'text') && input.value.length > 0) {\r\n                data[name] = input.value;\r\n            }\r\n\r\n        });\r\n        inputs.forEach(input => {\r\n            const name = input.getAttribute('name');\r\n            if (!data[name] && input.getAttribute('type') !== 'checkbox') {\r\n                allow = false;\r\n            }\r\n        });\r\n        return allow ? data : false;\r\n    }\r\n    getInputs(data) {\r\n        const inputs = [];\r\n        for (let key in data) {\r\n            const input = document.createElement('input');\r\n            input.setAttribute('type', 'hidden');\r\n            input.setAttribute('name', key);\r\n            input.setAttribute('value', data[key]);\r\n            inputs.push(input);\r\n        }\r\n        return inputs;\r\n    }\r\n    changeImage(i) {\r\n        let changable = true;\r\n        this.mainImg.forEach(el => {\r\n            if (el === undefined || el === null) changable = false;\r\n        });\r\n        if (changable) {\r\n            const img = this.el.querySelector('.gate-form__img img');\r\n            img.setAttribute('src', this.mainImg[i]);\r\n        }\r\n    }\r\n    togglePanels(action = 'auto') {\r\n        const typeInputs = this.el.querySelectorAll('input[name=\"gate-type\"]');\r\n        const panelInputs = this.el.querySelectorAll('input[name=\"gate-panel\"]');\r\n        const panelLabels = this.el.querySelectorAll('input[name=\"gate-panel\"] + label');\r\n        function hide() {\r\n            for (let i = 1; i < panelInputs.length; i++) {\r\n                panelInputs[i].checked = false;\r\n                panelLabels[i].style.display = 'none';\r\n            }\r\n        }\r\n        function show() {\r\n            panelLabels.forEach(label => {\r\n                label.style.display = '';\r\n            });\r\n        }\r\n        switch (action) {\r\n            case 'show':\r\n                show();\r\n                break;\r\n            case 'hide':\r\n                hide();\r\n                break;\r\n            case 'auto':\r\n                typeInputs[0].checked ? show() : hide();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    getPanelIndex() {\r\n        const panelInputs = this.el.querySelectorAll('input[name=\"gate-panel\"]');\r\n        // console.log(panelInputs);\r\n        for (let i = 0; i < panelInputs.length; i++) {\r\n            if (panelInputs[i].checked) return i;\r\n        }\r\n    }\r\n    _setupInputs() {\r\n        const setOutput = (name, val) => {\r\n            const span = this.el.querySelector('.output span[data-output=\"' + name + '\"]');\r\n            if (span !== null) {\r\n                span.innerText = val;\r\n            }\r\n        }\r\n        const setOutputById = (id, val) => {\r\n            const span = this.el.querySelector('.output span[data-output-by-id=\"' + id + '\"]');\r\n            if (span !== null) {\r\n                span.innerText = val;\r\n            }\r\n        }\r\n        const cb = this.el.querySelectorAll('input[type=checkbox]');\r\n        const radio = this.el.querySelectorAll('input[type=radio]');\r\n        const number = this.el.querySelectorAll('input[type=number]');\r\n        cb.forEach(inp => {\r\n            inp.addEventListener('change', e => {\r\n                const id = inp.getAttribute('id');\r\n\r\n                if (this.el.querySelector('.output span[data-output-by-id=\"' + id + '\"]') !== null) {\r\n                    inp.checked ?\r\n                        setOutputById(id, 'Да') :\r\n                        setOutputById(id, 'Нет');\r\n                } else {\r\n                    inp.checked ?\r\n                        setOutput(inp.getAttribute('name'), 'Да') :\r\n                        setOutput(inp.getAttribute('name'), 'Нет');\r\n                }\r\n            });\r\n        });\r\n        radio.forEach((inp, idx) => {\r\n            inp.addEventListener('change', e => {\r\n                setOutput(inp.getAttribute('name'), inp.value);\r\n                if (this.selector.match('.garage') && inp.getAttribute('name') == 'gate-type') {\r\n                    this.togglePanels();\r\n                    if (this.getPanelIndex() === undefined) {\r\n                        setOutput('gate-panel', '-');\r\n                    }\r\n                }\r\n                if (inp.getAttribute('name') == 'gate-type') {\r\n                    this.changeImage(idx);\r\n                }\r\n            });\r\n        });\r\n        number.forEach(inp => {\r\n            inp.addEventListener('change', e => {\r\n                setOutput(inp.getAttribute('name'), inp.value);\r\n            });\r\n        });\r\n    }\r\n    clearHiddenInputs() {\r\n        const inputs = this.form.querySelectorAll('input[type=\"hidden\"][name^=\"gate\"]');\r\n        inputs.forEach(input => {\r\n            input.remove();\r\n        });\r\n    }\r\n    setup() {\r\n        this.el.addEventListener('submit', e => {\r\n            e.preventDefault();\r\n            const data = this.getFormData();\r\n            if (data) {\r\n                this.clearHiddenInputs();\r\n                const inputs = this.getInputs(data);\r\n                inputs.forEach(inp => {this.form.appendChild(inp)});\r\n                this.onSubmit();\r\n            } else {\r\n                this.onIncorrect();\r\n            }\r\n        });\r\n        this._setupInputs();\r\n        // if (this.selector.match('.garage')) {\r\n        //     this.togglePanels('hide');\r\n        // }\r\n    }\r\n}\r\n\r\nclass InfoTooltips {\r\n    constructor() {\r\n        this.elems = document.querySelectorAll('.info');\r\n        this.contentItems = document.querySelectorAll('.info .info__content');\r\n        this.btns = document.querySelectorAll('.info .info__btn');\r\n        this.tooltip = null;\r\n        this.setup();\r\n    }\r\n    getTooltipElem(elem) {\r\n        const tooltip = elem.cloneNode(true);\r\n        tooltip.classList = '';\r\n        tooltip.classList.add('info-tooltip');\r\n        return tooltip;\r\n    }\r\n    setTooltip(x, y) {\r\n        this.tooltip.style.left = x + 'px';\r\n        this.tooltip.style.top = y + 'px';\r\n        document.body.append(this.tooltip);\r\n    }\r\n    removeTooltip() {\r\n        this.tooltip.remove();\r\n        this.tooltip = null;\r\n    }\r\n    setup() {\r\n        this.btns.forEach((btn, idx) => {\r\n            btn.addEventListener('mouseenter', e => {\r\n                const x = (e.pageX + 20);\r\n                const y = (e.pageY + 5);\r\n                this.tooltip = this.getTooltipElem(this.contentItems[idx]);\r\n                this.setTooltip(x, y);\r\n            });\r\n            btn.addEventListener('mouseleave', e => {\r\n                this.removeTooltip();\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nlet activeModal = null;\r\n\r\nclass Modal {\r\n    constructor(selector, {onCall}) {\r\n        this.selector = selector;\r\n        this.el = document.querySelector(this.selector);\r\n        if (this.el) {\r\n            this.onCall = onCall || function(){};\r\n            this.overlay = this.el.querySelector('.modal__overlay');\r\n            this.closeBtn = this.el.querySelector('.modal__close');\r\n            this.setup();\r\n        }\r\n    }\r\n    showModal(disableAnimation = false) {\r\n        activeModal = this;\r\n        if (disableAnimation) {\r\n            this.el.classList.add('active');\r\n        } else {\r\n            this.el.classList.remove('hiding');\r\n            this.el.classList.add('active');\r\n            this.el.classList.add('showing');\r\n            setTimeout(() => {\r\n                this.el.classList.remove('showing');\r\n            }, 250);\r\n        }\r\n        document.body.classList.add('lock');\r\n        this.onCall();\r\n    }\r\n    hideModal(disableAnimation = false) {\r\n        activeModal = null;\r\n        if (disableAnimation) {\r\n            this.el.classList.remove('active');\r\n        } else {\r\n            this.el.classList.remove('showing');\r\n            this.el.classList.add('hiding');\r\n            setTimeout(() => {\r\n                this.el.classList.remove('active');\r\n                this.el.classList.remove('hiding');\r\n            }, 250);\r\n        }\r\n        document.body.classList.remove('lock');\r\n    }\r\n    showingHandler() {\r\n        this.el.classList.contains('active') ?\r\n            this.hideModal() :\r\n            this.showModal();\r\n    }\r\n    setup() {\r\n        this.closeBtn.addEventListener('click', (e) => {\r\n            this.hideModal();\r\n        });\r\n        this.overlay.addEventListener('mousedown', (e) => {\r\n            if (e.target === this.overlay) {\r\n                this.hideModal();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\nfunction sendForm(form, onSuccess = null) {\r\n    onSuccess = onSuccess || function(){};\r\n    event.preventDefault();\r\n    if (validateForm(form)) {\r\n        var xhr = new XMLHttpRequest();\r\n        var body = serialize(form);\r\n        xhr.open('POST', './mail.php');\r\n        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n        xhr.onreadystatechange = function() {\r\n            if (xhr.readyState == 4 && xhr.status == 200) {\r\n                form.reset();\r\n                onSuccess();\r\n                form.setAttribute('data-done', null);\r\n                if (form.hasAttribute('data-after')) {\r\n                    activeModal ? activeModal.hideModal() : void(0);\r\n                    const id = form.getAttribute('data-after');\r\n                    afterModals[id].showModal();\r\n                }\r\n            }\r\n        };\r\n        xhr.send(body);\r\n    } else {\r\n        alert('Введите корректные данные');\r\n    }\r\n}\r\nfunction validateForm(form) {\r\n\tvar regTel = /^((8|\\+7)[\\- ]?)?(\\(?\\d{3}\\)?[\\- ]?)?[\\d\\- ]{7,10}$/;\r\n\tvar inputTel = form.querySelector('input[name=\"tel\"]');\r\n    var inputName = form.querySelector('input[name=\"name\"]');\r\n    var allow = true;\r\n    if (inputTel && !inputTel.value.match(regTel)) allow = false;\r\n    if (inputName && inputName.value.length < 2) allow = false;\r\n    return allow;\r\n}\r\nfunction serialize(form) {\r\n\tif (!form || form.nodeName !== \"FORM\") {\r\n\t\treturn false;\r\n\t}\r\n\tvar i, j, q = [];\r\n\tfor (i = form.elements.length - 1; i >= 0; i = i - 1) {\r\n\t\tif (form.elements[i].name === \"\") {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tswitch (form.elements[i].nodeName) {\r\n\t\t\tcase 'INPUT':\r\n\t\t\t\tswitch (form.elements[i].type) {\r\n\t\t\t\t\tcase 'text':\r\n\t\t\t\t\tcase 'tel':\r\n\t\t\t\t\tcase 'email':\r\n\t\t\t\t\tcase 'hidden':\r\n\t\t\t\t\tcase 'password':\r\n\t\t\t\t\tcase 'button':\r\n\t\t\t\t\tcase 'reset':\r\n\t\t\t\t\tcase 'submit':\r\n\t\t\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\twriteCommaCheckbox(form, i, q);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (form.elements[i].checked) {\r\n\t\t\t\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'file':\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'TEXTAREA':\r\n\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'SELECT':\r\n\t\t\t\tswitch (form.elements[i].type) {\r\n\t\t\t\t\tcase 'select-one':\r\n\t\t\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'select-multiple':\r\n\t\t\t\t\t\tfor (j = form.elements[i].options.length - 1; j >= 0; j = j - 1) {\r\n\t\t\t\t\t\t\tif (form.elements[i].options[j].selected) {\r\n\t\t\t\t\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].options[j].value));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'BUTTON':\r\n\t\t\t\tswitch (form.elements[i].type) {\r\n\t\t\t\t\tcase 'reset':\r\n\t\t\t\t\tcase 'submit':\r\n\t\t\t\t\tcase 'button':\r\n\t\t\t\t\t\tq.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn q.join(\"&\");\r\n}\r\n\r\nconst tooltips = new InfoTooltips();\r\n\r\nconst ownModal = new Modal('#ownForm', {\r\n    onCall: function() {\r\n        const form = ownModal.el.querySelector('form');\r\n        if (form && form.hasAttribute('data-done')) {\r\n            ownModal.hideModal(true);\r\n            const id = form.getAttribute('data-after');\r\n            afterModals[id].showModal();\r\n        }\r\n    }\r\n});\r\nconst garageGateModal = new Modal('#garageGateForm', {\r\n    onCall: function() {\r\n        const form = garageGateModal.el.querySelector('form');\r\n        if (form && form.hasAttribute('data-done')) {\r\n            garageGateModal.hideModal(true);\r\n            const id = form.getAttribute('data-after');\r\n            afterModals[id].showModal();\r\n        }\r\n    }\r\n});\r\nconst swingGateModal = new Modal('#swingGateForm', {\r\n    onCall: function() {\r\n        const form = swingGateModal.el.querySelector('form');\r\n        if (form && form.hasAttribute('data-done')) {\r\n            swingGateModal.hideModal(true);\r\n            const id = form.getAttribute('data-after');\r\n            afterModals[id].showModal();\r\n        }\r\n    }\r\n});\r\nconst slidingGateModal = new Modal('#slidingGateForm', {\r\n    onCall: function() {\r\n        const form = slidingGateModal.el.querySelector('form');\r\n        if (form && form.hasAttribute('data-done')) {\r\n            slidingGateModal.hideModal(true);\r\n            const id = form.getAttribute('data-after');\r\n            afterModals[id].showModal();\r\n        }\r\n    }\r\n});\r\nconst callModal = new Modal('#callMe', {\r\n    onCall: function() {\r\n        const form = callModal.el.querySelector('form');\r\n        if (form && form.hasAttribute('data-done')) {\r\n            callModal.hideModal(true);\r\n            const id = form.getAttribute('data-after');\r\n            afterModals[id].showModal();\r\n        }\r\n    }\r\n});\r\nconst thanksCalc = new Modal('#thanksCalc', {});\r\nconst thanksCall = new Modal('#thanksCall', {});\r\nconst incorrectFields = new Modal('#incorrectFields', {});\r\nconst afterModals = {\r\n    thanksCalc, thanksCall\r\n};\r\n\r\nconst ownGateForm = new GateForm('.own .gate-form', {\r\n    formSelector: '#ownForm form',\r\n    onSubmit: function() {\r\n        ownModal.showModal();\r\n    },\r\n    onIncorrect: function() {\r\n        incorrectFields.showModal();\r\n    },\r\n});\r\nconst garageGateForm = new GateForm('.garage .gate-form', {\r\n    formSelector: '#garageGateForm form',\r\n    onSubmit: function() {\r\n        garageGateModal.showModal();\r\n    },\r\n    onIncorrect: function() {\r\n        incorrectFields.showModal();\r\n    }\r\n});\r\nconst slidingGateForm = new GateForm('.sliding .gate-form', {\r\n    formSelector: '#slidingGateForm form',\r\n    onSubmit: function() {\r\n        slidingGateModal.showModal();\r\n    },\r\n    onIncorrect: function() {\r\n        incorrectFields.showModal();\r\n    }\r\n});\r\nconst swingGateForm = new GateForm('.swing .gate-form', {\r\n    formSelector: '#swingGateForm form',\r\n    onSubmit: function() {\r\n        swingGateModal.showModal();\r\n    },\r\n    onIncorrect: function() {\r\n        incorrectFields.showModal();\r\n    }\r\n});\r\n\r\nconst showModalCallBtn = document.querySelector('#showModalCall');\r\nshowModalCallBtn.addEventListener('click', function() {\r\n    callModal.showModal();\r\n});"],"file":"../main.min.js"}