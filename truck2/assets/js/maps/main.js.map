{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["var $labels = document.querySelectorAll('.calculator__cb-custom');\r\nvar $menuItems = document.querySelectorAll('.menu__item .menu__link');\r\n\r\nvar $mark = document.querySelector('#svgMapMark');\r\nvar $dots = document.querySelectorAll('.svg-map-dot');\r\nvar $regions = document.querySelectorAll('.svg-map-region');\r\n\r\nvar $citiesInfo = document.querySelectorAll('.dealer__info');\r\nvar dotsData = [];\r\n\r\nvar $burger = document.querySelector('#burger');\r\nvar $headerMenu = document.querySelector('#headerMenu');\r\nvar $body = document.body;\r\n\r\nvar $callPopupBtns = document.querySelectorAll('[data-call-popup]');\r\nvar $popupList = document.querySelectorAll('.popup');\r\n\r\nvar $header = document.querySelector('#header');\r\nvar $catalogTabs = document.querySelectorAll('.catalog__tabs .catalog__tab');\r\nvar $catalogContents = document.querySelectorAll('.catalog__contents .catalog__list');\r\n\r\nvar $cityList = document.querySelectorAll('.popup__city-link');\r\nvar $form = document.querySelector('.popup__form.request-form');\r\n\r\n\r\nvar currentCity = 'Москва';\r\n\r\nvar slider = new Splide( '#charsSlider', {\r\n    type: 'loop',\r\n    rewind: false,\r\n    arrows: false,\r\n    pagination: false,\r\n    autoplay: true,\r\n    interval: 4000,\r\n    pauseOnHover: false,\r\n    perMove: 1,\r\n    autoWidth: true,\r\n    gap: 20,\r\n    height: 400,\r\n    breakpoints: {\r\n        1439: {\r\n            height: 320\r\n        },\r\n        1024: {\r\n            height: 255\r\n        },\r\n        767: {\r\n            height: 200\r\n        }\r\n    }\r\n});\r\nslider.mount();\r\n\r\n/* ОТКРЫТИЕ МОДАЛЬНОГО ОКНА \"ВАШ ГОРОД МОСКВА?\" */\r\n// showPopup('popupConfirmCity');\r\n/* ==================== */\r\n\r\nfor (let i = 0; i < $labels.length; i++) {\r\n    $labels[i].onkeydown = function() {\r\n        if (event.key === 'Enter') {\r\n            let cb = document.querySelector('input[type=\"checkbox\"]#' + $labels[i].getAttribute('for'));\r\n            cb.checked = !cb.checked;\r\n        }\r\n    };\r\n}\r\n\r\nfor (let i = 0; i < $menuItems.length; i++) {\r\n    var elem = $menuItems[i];\r\n    var handler = scrollHandler.bind(null, elem);\r\n    elem.addEventListener('click', handler);\r\n}\r\nfunction scrollHandler(elem) {\r\n    if ($burger.classList.contains('active')) {\r\n        closeMenu();\r\n    }\r\n    var href = elem.getAttribute('href').substr(1);\r\n    event.preventDefault();\r\n    document.getElementById(href).scrollIntoView({block: \"start\", behavior: \"smooth\"});\r\n}\r\n\r\nfor (let i = 0; i < $dots.length; i++) {\r\n    var obj = {\r\n        x: parseInt($dots[i].getAttribute('cx')),\r\n        y: parseInt($dots[i].getAttribute('cy')),\r\n        r: parseInt($dots[i].getAttribute('r')),\r\n    };\r\n    dotsData.push(obj);\r\n    var setMarkFunc = setMark.bind(null, i);\r\n    $dots[i].addEventListener('click', setMarkFunc);\r\n    $regions[i].addEventListener('click', setMarkFunc);\r\n}\r\nif (window.innerWidth <=767) {\r\n    for (let i = 0; i < $dots.length; i++) {\r\n        var currentR = $dots[i].getAttribute('r');\r\n        $dots[i].setAttribute('r', currentR * 2);\r\n    }\r\n}\r\n\r\nsetMark(0);\r\nfunction setMark(ind) {\r\n    var offsetX = +$mark.getAttribute('width') / 2;\r\n    var offsetY = +$mark.getAttribute('height');\r\n    if ($dots[ind].classList !== undefined) {\r\n        for (let i = 0; i < $dots.length; i++) {\r\n            $dots[i].classList.remove('hidden');\r\n            $citiesInfo[i].classList.add('hidden');\r\n        }\r\n        $dots[ind].classList.add('hidden');\r\n        $citiesInfo[ind].classList.remove('hidden');\r\n        $mark.setAttribute('x', dotsData[ind].x - offsetX);\r\n        $mark.setAttribute('y', dotsData[ind].y - offsetY);   \r\n    } else {\r\n        for (let i = 0; i < $citiesInfo.length; i++) {\r\n            $citiesInfo[i].classList.add('hidden');\r\n        }\r\n        $citiesInfo[ind].classList.remove('hidden');\r\n        $mark.setAttribute('x', dotsData[ind].x - offsetX);\r\n        $mark.setAttribute('y', dotsData[ind].y - offsetY);   \r\n    }\r\n}\r\n\r\n\r\n$burger.addEventListener('click', function() {\r\n    if ($burger.classList.contains('active')) {\r\n        closeMenu();\r\n    } else {\r\n        openMenu();\r\n    }\r\n});\r\nfunction closeMenu() {\r\n    $burger.classList.remove('active');\r\n    $headerMenu.classList.remove('active');\r\n    $body.classList.remove('lock');\r\n}\r\nfunction openMenu() {\r\n    $burger.classList.add('active');\r\n    $headerMenu.classList.add('active');\r\n    $body.classList.add('lock');\r\n}\r\n\r\n\r\n\r\nfor (let i = 0; i < $callPopupBtns.length; i++) {\r\n    let elem = $callPopupBtns[i];\r\n    $callPopupBtns[i].addEventListener('click', function() {\r\n        event.preventDefault();\r\n        showPopup(elem.getAttribute('data-call-popup'));\r\n    });\r\n}\r\nfor (let i = 0; i < $popupList.length; i++) {\r\n    let elem = $popupList[i];\r\n    $popupList[i].addEventListener('click', function() {\r\n        if (event.target.classList.contains('popup') && event.target.classList.contains('active')) {\r\n            hidePopup(elem.id);\r\n        }\r\n    });\r\n}\r\nfor (let i = 0; i < $cityList.length; i++) {\r\n    let elem = $cityList[i];\r\n    elem.addEventListener('click', function() {\r\n        event.preventDefault();\r\n        // currentCity = elem.textContent;\r\n        hidePopup('popupSelectCity');\r\n        setCity(elem.textContent);\r\n    });\r\n}\r\n\r\nfunction setCity(city) {\r\n    currentCity = city;\r\n    // hidePopup('#popupSelectCity');\r\n    let $geoLinks = document.querySelectorAll('.geo__link');\r\n    for (let i = 0; i < $geoLinks.length; i++) {\r\n        $geoLinks[i].textContent = currentCity;\r\n    }\r\n}\r\n\r\nfunction showPopup(id) {\r\n    var $popup = document.getElementById(id);\r\n    for (let i = 0; i < $popupList.length; i++) {\r\n        if (id !== $popupList[i].id  ) {\r\n            $popupList[i].classList.remove('active');\r\n            $popupList[i].classList.remove('fade-out');\r\n        }\r\n    }\r\n    $popup.classList.add('active');\r\n    $popup.classList.add('fade-in');\r\n    $body.classList.add('lock');\r\n}\r\nfunction hidePopup(id) {\r\n    var $popup = document.getElementById(id);\r\n    $popup.classList.remove('fade-in');\r\n    $popup.classList.add('fade-out');\r\n    function removing() {\r\n        $popup.classList.remove('active');\r\n        $popup.classList.remove('fade-out');\r\n        $body.classList.remove('lock');\r\n        $popup.removeEventListener('animationend', removing);\r\n    }\r\n    $popup.addEventListener('animationend', removing);\r\n}\r\n\r\n// var scrollPrev = 0;\r\n\r\nwindow.addEventListener('scroll', function() {\r\n    if (document.documentElement.scrollTop > 99) {\r\n        $header.classList.add('fixed');\r\n    } else {\r\n        $header.classList.remove('fixed');\r\n    }\r\n});\r\n\r\n\r\nfor (let i = 0; i < $catalogTabs.length; i++) {\r\n    var func = activateTabContent.bind(null, i);\r\n    $catalogTabs[i].addEventListener('click', func);\r\n}\r\n\r\nfunction activateTabContent(ind) {\r\n    for (let j = 0; j < $catalogContents.length; j++) {\r\n        $catalogTabs[j].classList.remove('active');\r\n        $catalogContents[j].classList.add('hidden');\r\n    }\r\n    $catalogTabs[ind].classList.add('active');\r\n    $catalogContents[ind].classList.remove('hidden');\r\n}\r\n\r\nfunction validateForm(form) {\r\n    var regTel = /^((8|\\+7)[\\- ]?)?(\\(?\\d{3}\\)?[\\- ]?)?[\\d\\- ]{7,11}$/;\r\n    var regName = /^[а-яё]+$/i;\r\n    var inputName = form.querySelector('input[name=\"name\"]');\r\n    var inputTel = form.querySelector('input[name=\"tel\"]');\r\n    if (inputTel.value.match(regTel) && inputName.value.match(regName)) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\nfunction serialize(form) {\r\n    if (!form || form.nodeName !== \"FORM\") {\r\n        return false;\r\n    }\r\n    var i, j, q = [];\r\n    for (i = form.elements.length - 1; i >= 0; i = i - 1) {\r\n        if (form.elements[i].name === \"\") {\r\n            continue;\r\n        }\r\n        switch (form.elements[i].nodeName) {\r\n            case 'INPUT':\r\n                switch (form.elements[i].type) {\r\n                    case 'text':\r\n                    case 'tel':\r\n                    case 'email':\r\n                    case 'hidden':\r\n                    case 'password':\r\n                    case 'button':\r\n                    case 'reset':\r\n                    case 'submit':\r\n                        q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                        break;\r\n                    case 'checkbox':\r\n                        writeCommaCheckbox(form, i, q);\r\n                        break;\r\n                    case 'radio':\r\n                        if (form.elements[i].checked) {\r\n                            q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n            case 'file':\r\n                break;\r\n            case 'TEXTAREA':\r\n                q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                break;\r\n            case 'SELECT':\r\n                switch (form.elements[i].type) {\r\n                    case 'select-one':\r\n                        q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                        break;\r\n                    case 'select-multiple':\r\n                        for (j = form.elements[i].options.length - 1; j >= 0; j = j - 1) {\r\n                            if (form.elements[i].options[j].selected) {\r\n                                q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].options[j].value));\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n            case 'BUTTON':\r\n                switch (form.elements[i].type) {\r\n                    case 'reset':\r\n                    case 'submit':\r\n                    case 'button':\r\n                        q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                        break;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    return q.join(\"&\");\r\n}\r\n\r\nfunction sendForm() {\r\n    event.preventDefault();\r\n    var xhr = new XMLHttpRequest();\r\n    var body = serialize($form);\r\n    xhr.open('POST', './mail.php');\r\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n    xhr.onreadystatechange = function() {\r\n        if (xhr.readyState == 4 && xhr.status == 200) {\r\n            $form.reset();\r\n            alert('Спасибо за заявку!');\r\n        }\r\n    };\r\n    xhr.send(body);\r\n}\r\n$form.addEventListener('submit', sendForm);\r\n\r\n\r\n\r\n/* NEW SCRIPTS */\r\n\r\n\r\nvar calcData = {\r\n    interval: 2000,\r\n    streetJsonPath: './assets/other/streets.json',\r\n    homeJsonPath: './assets/other/homes.json',\r\n    $streetInput: document.querySelector('#addressStreet'),\r\n    $homeInput: document.querySelector('#addressHome'),\r\n    jsonData: [],\r\n    nodeList: [],\r\n    resultList: [],\r\n    limitShown: 5,\r\n    datalistShown: false,\r\n    datalist: null,\r\n    lastReqTime: 0,\r\n    timer: null,\r\n    xhr: new XMLHttpRequest(),\r\n    isStreetSeledted: false,\r\n};\r\n\r\ncalcData.$streetInput.addEventListener('focus', \r\n    datalistHandler.bind(null, calcData.streetJsonPath, calcData.$streetInput));\r\n\r\ncalcData.$streetInput.addEventListener('input', \r\n    datalistHandler.bind(null, calcData.streetJsonPath, calcData.$streetInput));\r\n\r\ncalcData.$homeInput.addEventListener('focus', \r\n    datalistHandler.bind(null, calcData.homeJsonPath, calcData.$homeInput));\r\n\r\ncalcData.$homeInput.addEventListener('input', \r\n    datalistHandler.bind(null, calcData.homeJsonPath, calcData.$homeInput));\r\n\r\ncalcData.$streetInput.addEventListener('blur', hideDatalist.bind(null, calcData.$streetInput));\r\ncalcData.$homeInput.addEventListener('blur', hideDatalist.bind(null, calcData.$homeInput));\r\n\r\nfunction getDatalistData(path, value, callback) {\r\n    var timeNow = new Date().getTime();\r\n    var diff = timeNow - calcData.lastReqTime;\r\n    xhr = calcData.xhr;\r\n\r\n    // xhr.setRequestHeader('header1', '123');\r\n    // xhr.setRequestHeader('header2', '123');\r\n    // xhr.setRequestHeader('header3', '123');\r\n\r\n    value = '';     //убрать \r\n\r\n    xhr.open('GET', path + value);\r\n    xhr.onload = function() {\r\n        if (xhr.readyState == 4 && xhr.status == 200) {\r\n            var results = JSON.parse(xhr.response);\r\n            callback(results);\r\n            calcData.lastReqTime = new Date().getTime();\r\n        } else if (xhr.readyState == 4 && xhr.status !== 200) {\r\n            return;\r\n        }\r\n    }\r\n    if (diff >= calcData.interval) {\r\n        xhr.send();\r\n    } else {\r\n        clearTimeout(calcData.timer);\r\n        calcData.timer = setTimeout(() => {\r\n            getDatalistData(path, value, callback);\r\n        }, calcData.interval - diff);\r\n    }\r\n}\r\n\r\nfunction datalistHandler(path, input) {\r\n    if (event.type == 'focus' || event.type == 'input' || event.type == 'change') {\r\n        calcData.datalistShown = true;\r\n    } else {\r\n        calcData.datalistShown = false;\r\n    }\r\n    var val = input.value;\r\n    var datalistElem = document.querySelector('.calculator__datalist[data-for=\"'+ input.getAttribute('id') +'\"]');\r\n\r\n    if (val.length >= 2 && calcData.datalistShown) {\r\n        getDatalistData(path, val, function(arr) {\r\n            calcData.jsonData = arr;\r\n            setResultDatalist(val);\r\n            showDatalist(datalistElem);\r\n        });\r\n    } else {\r\n        hideDatalist(input);\r\n    }\r\n}\r\n\r\nfunction homeInputDisabling() {\r\n    if (calcData.isStreetSeledted) {\r\n        calcData.$homeInput.removeAttribute('disabled');\r\n    } else {\r\n        calcData.$homeInput.setAttribute('disabled', 'disabled');\r\n    }\r\n}\r\n// homeInputDisabling();\r\n\r\nfunction showDatalist(elem) {\r\n    elem.innerHTML = '';\r\n    var arr = calcData.resultList;\r\n    var input = document.getElementById(elem.getAttribute('data-for'));\r\n    calcData.nodeList = [];\r\n    for (var i = 0; i < arr.length; i++) {\r\n        var item = document.createElement('div');\r\n        item.classList.add('calculator__datalist-item');\r\n        item.textContent = arr[i];\r\n        item.onmousedown = setInpVal.bind(null, item.textContent, input, elem)\r\n        // item.addEventListener('mousedown', setInpVal.bind(null, item.textContent, input, elem));\r\n        calcData.nodeList.push(item);\r\n        if (i >= calcData.limitShown) {break};\r\n    }\r\n    \r\n    function setInpVal(val, input) {\r\n        input.value = val;\r\n        calcData.$homeInput.value = '';\r\n        // if () {\r\n            // for (var k = 0; k < calcData.resultList; k++) {\r\n                // if (input.value == calcData.resultList[k]) {\r\n                    // calcData.isStreetSeledted = true;\r\n                    // homeInputDisabling();\r\n                    // console.log(true);\r\n                    // break;\r\n                // }\r\n            // }\r\n        // }\r\n    }\r\n\r\n    for (var i = 0; i < calcData.nodeList.length; i++) {\r\n        elem.appendChild(calcData.nodeList[i]);\r\n    }\r\n    elem.classList.add('shown');\r\n}\r\n\r\nfunction hideDatalist(input) {\r\n    var elem = document.querySelector('.calculator__datalist[data-for=\"'+ input.getAttribute('id') +'\"]');\r\n    elem.innerHTML = '';\r\n    elem.classList.remove('shown');\r\n    calcData.datalistShown = false;\r\n    console.log(input);\r\n    calcData.xhr.abort();\r\n    clearTimeout(calcData.timer);\r\n}\r\n\r\nfunction setResultDatalist() {\r\n    calcData.resultList = [];\r\n    var arr = calcData.jsonData;\r\n    for (var i = 0; i < arr.length; i++) {\r\n        var str = arr[i]['title'];\r\n        if (arr[i]['parents']) {\r\n            str += ' (' + arr[i]['parents'] + ')';\r\n        }\r\n        calcData.resultList.push(str);\r\n    }\r\n}"],"file":"../main.js"}