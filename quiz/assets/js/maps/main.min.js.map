{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["var quiz = document.querySelector('#quiz');\r\nvar closeBtn = document.querySelector('.quiz__close');\r\nvar roomsItems = document.querySelectorAll('.quiz__rooms-item');\r\nvar roomsImgs = document.querySelectorAll('.quiz__rooms-img');\r\nvar roomsRadio = document.querySelectorAll('input[name=\"rooms\"]');\r\nvar regionRadio = document.querySelectorAll('.quiz__region-radio');\r\nvar regionItems = document.querySelectorAll('.quiz__region-item');\r\nvar renovatedRadio = document.querySelectorAll('.quiz__renovated-radio');\r\nvar renovatedItems = document.querySelectorAll('.quiz__renovated-item');\r\nvar btnsCallQuiz = document.querySelectorAll('[data-call-popup]');\r\nvar tooltipElem = document.querySelector('.quiz__tooltip');\r\nvar contents = document.querySelectorAll('.quiz__content');\r\nvar main = document.querySelector('.quiz__main');\r\nvar sidebar = document.querySelector('.quiz__sidebar');\r\nvar confirmWindow = document.querySelector('.quiz__confirm');\r\nvar successWindow = document.querySelector('.quiz__success');\r\nvar submitBtn = document.querySelector('.quiz__confirm-btn');\r\nvar areaInput = document.querySelector('.quiz__area-input input');\r\nvar floorInput = document.querySelector('.quiz__floor-input input');\r\n\r\nsubmitBtn.addEventListener('click', function(e) {\r\n    e.preventDefault();\r\n    confirmWindow.classList.add('hidden');\r\n    successWindow.classList.remove('hidden');\r\n    document.querySelector('.quiz__inner').classList.add('autoheight');\r\n\r\n    // sendForm();\r\n});\r\n\r\n/* ===DATA=== */\r\nvar controls = {\r\n    // tooltip: document.querySelector('.quiz__tooltip'),\r\n    progressBar: document.querySelector('.quiz__progress'),\r\n    progressItems: document.querySelectorAll('.quiz__progress-item'),\r\n    btnPrev: document.querySelector('.quiz__btn--prev'),\r\n    btnNext: document.querySelector('.quiz__btn--next'),\r\n    currentPage: 0,\r\n};\r\n\r\nvar tooltips = [\r\n    'Выберите подходящий ответ, нажав на него',\r\n    'Пожалуйста, воспользуйтесь ползунком для этого. Если не знаете точно - укажите примерную площадь. Точную площадь вы можете узнать в паспорте квартиры или в платёжке ЖКХ',\r\n    'Выберите подходящий ответ, нажав на него',\r\n    'Пожалуйста, воспользуйтесь ползунком для этого',\r\n    'Выберите подходящий ответ, нажав на него'\r\n];\r\nvar quizData = {\r\n    \r\n};\r\n/* ========== */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* ===FUNCTIONS=== */\r\nfunction showPopup(selector) {\r\n    var popup = document.querySelector(selector);\r\n    popup.classList.add('shown');\r\n    document.querySelector('#main').classList.add('blured');\r\n}\r\nfunction hidePopup(selector) {\r\n    var popup = document.querySelector(selector);\r\n    popup.classList.remove('shown');\r\n    document.querySelector('#main').classList.remove('blured');\r\n}\r\nfunction roomsImgBg() {\r\n    for (var i = 0; i < roomsItems.length; i++) {\r\n        var url = roomsImgs[i].src;\r\n        roomsItems[i].style.backgroundImage = 'url(' + url + ')';\r\n    }\r\n}\r\nfunction radioHandler(itemList, radioList, afterSelect = null) {\r\n    for (var i = 0; i < itemList.length; i++) {\r\n        var select = selectRadio.bind(null, i);\r\n        var handler = selectItem.bind(null, i);\r\n        itemList[i].addEventListener('click', select);\r\n        itemList[i].addEventListener('change', handler);\r\n    }\r\n    function selectItem(ind) {\r\n        for (var j = 0; j < itemList.length; j++) {\r\n            itemList[j].classList.remove('checked');\r\n        }\r\n        itemList[ind].classList.add('checked');\r\n        if (afterSelect) {afterSelect();}\r\n    }\r\n    function selectRadio(ind) {\r\n        radioList[ind].checked = true;\r\n        selectItem(ind);\r\n    }\r\n}\r\nfunction quizBtnsHandler() {\r\n    if (controls.currentPage === 0) {\r\n        controls.btnPrev.setAttribute('disabled', 'disabled');\r\n    } else {\r\n        controls.btnPrev.removeAttribute('disabled');\r\n    }\r\n    if (window.innerWidth > 480) {\r\n        if (controls.currentPage === contents.length - 1) {\r\n            controls.btnNext.textContent = 'последний шаг';\r\n        } else {\r\n            controls.btnNext.textContent = 'далее';\r\n        }\r\n    }\r\n}\r\nfunction nextSlide() {\r\n    var radios = contents[controls.currentPage].querySelectorAll('input[type=\"radio\"]');\r\n    var title = contents[controls.currentPage].querySelector('.quiz__title');\r\n    var allow = false;\r\n    if (radios.length > 0) {\r\n        for (var k = 0; k < radios.length; k++) {\r\n            if (radios[k].checked) {allow = true;}\r\n        }\r\n    } else {allow = true;}\r\n    if (controls.currentPage < contents.length - 1 && allow) {\r\n        title.classList.remove('not-allow');\r\n        contents[controls.currentPage].classList.add('hidden');\r\n        contents[++controls.currentPage].classList.remove('hidden');\r\n    } else if (controls.currentPage === contents.length - 1 && allow) {\r\n        title.classList.remove('not-allow');\r\n        showFinalForm();\r\n    } else {\r\n        title.classList.remove('not-allow');\r\n        title.classList.add('not-allow');\r\n        title.onanimationend = function() {title.classList.remove('not-allow');};\r\n    }\r\n    quizBtnsHandler();\r\n    progressBarHandler();\r\n    tooltipsHandler();\r\n    quizHandleValues();\r\n}\r\nfunction prevSlide() {\r\n    if (controls.currentPage > 0) {\r\n        contents[controls.currentPage].classList.add('hidden');\r\n        contents[--controls.currentPage].classList.remove('hidden');\r\n    }\r\n    quizBtnsHandler();\r\n    progressBarHandler();\r\n    tooltipsHandler();\r\n}\r\nfunction progressBarHandler() {\r\n    for (var i = 0; i < controls.progressItems.length; i++) {\r\n        controls.progressItems[i].classList.remove('checked');\r\n    }\r\n    for (var i = 0; i < controls.currentPage+1; i++) {\r\n        controls.progressItems[i].classList.add('checked');\r\n    }\r\n}\r\nfunction tooltipsHandler() {\r\n    var text = tooltips[controls.currentPage];\r\n    var textArr = text.split(' ');\r\n    var resultText = '';\r\n    // var prevText = '';\r\n\r\n    if (window.innerWidth < 767) {\r\n        var span = document.createElement('span');\r\n        for (var i = 0; i < textArr.length; i++) {\r\n            resultText += textArr[i] + ' ';\r\n            tooltipElem.innerHTML = '';\r\n            span.textContent = resultText;\r\n            tooltipElem.appendChild(span);\r\n            if (span.getClientRects().length >= 3) {\r\n                var cuttedText = textArr.slice(0, i - 1).join(' ') + ' ...';\r\n                span.textContent = cuttedText;\r\n                tooltipElem.appendChild(span);\r\n                tooltipElem.classList.add('closed');\r\n                tooltipElem.setAttribute('data-cutted-text', cuttedText);\r\n                break;\r\n            } else {\r\n                tooltipElem.classList.remove('closed');\r\n                tooltipElem.classList.remove('opened');\r\n                tooltipElem.removeAttribute('data-cutted-text');\r\n            }\r\n        }\r\n    } else {\r\n        tooltipElem.textContent = tooltips[controls.currentPage];\r\n    }\r\n}\r\nfunction showFinalForm() {\r\n    for (var i = 0; i < contents.length; i++) {\r\n        contents[i].classList.add('hidden');\r\n    }\r\n    confirmWindow.classList.remove('hidden');\r\n    main.classList.add('hidden');\r\n    sidebar.classList.add('hidden');\r\n}\r\nfunction handleRadioValue(input) {\r\n    quizData[input.name] = input.value;\r\n}\r\nfunction quizHandleValues() {\r\n    var rooms = null;\r\n    var region = null;\r\n    var renovated = null;\r\n    for (var i = 0; i < roomsRadio.length; i++) {\r\n        if (roomsRadio[i].checked) {\r\n            rooms = roomsRadio[i].value;\r\n        }\r\n    }\r\n    for (var i = 0; i < regionRadio.length; i++) {\r\n        if (regionRadio[i].checked) {\r\n            region = regionRadio[i].value;\r\n        }\r\n    }\r\n    for (var i = 0; i < renovatedRadio.length; i++) {\r\n        if (renovatedRadio[i].checked) {\r\n            renovated = renovatedRadio[i].value;\r\n        }\r\n    }\r\n\r\n    quizData.rooms = rooms;\r\n    quizData.region = region;\r\n    quizData.renovated = renovated;\r\n    quizData.area = quizAreaRange.noUiSlider.get();\r\n    quizData.floor = quizFloorRange.noUiSlider.get();\r\n    console.log(quizData);\r\n}\r\nfunction openOrCloseTooltip() {\r\n    var sidebarHeight = parseInt(sidebar.getBoundingClientRect().height) + 'px';\r\n    if (tooltipElem.classList.contains('closed')) {\r\n        sidebar.style.height = sidebarHeight;\r\n        tooltipElem.classList.remove('closed');\r\n        tooltipElem.classList.add('opened');\r\n        tooltipElem.firstElementChild.textContent = tooltips[controls.currentPage];\r\n    } else if (tooltipElem.classList.contains('opened')) {\r\n        sidebar.style.height = '';\r\n        tooltipElem.classList.remove('opened');\r\n        tooltipElem.classList.add('closed');\r\n        tooltipElem.firstElementChild.textContent = tooltipElem.getAttribute('data-cutted-text');\r\n    }\r\n}\r\nfunction sendForm(e) {\r\n    \r\n}\r\n/* =============== */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* ===HANDLERS=== */\r\nfor (var i = 0; i < btnsCallQuiz.length; i++) {\r\n    var show = showPopup.bind(null, btnsCallQuiz[i].getAttribute('data-call-popup'));\r\n    btnsCallQuiz[i].addEventListener('click', show);\r\n}\r\nquiz.addEventListener('mousedown', function(e) {\r\n    if (e.target === quiz || e.target === closeBtn) {\r\n        hidePopup('#' + quiz.id);\r\n    }\r\n});\r\ntooltipElem.addEventListener('click', openOrCloseTooltip);\r\nradioHandler(roomsItems, roomsRadio, nextSlide);\r\nradioHandler(regionItems, regionRadio, nextSlide);\r\nradioHandler(renovatedItems, renovatedRadio, nextSlide);\r\nroomsImgBg();\r\n\r\ncontrols.btnNext.addEventListener('click', nextSlide);\r\ncontrols.btnPrev.addEventListener('click', prevSlide);\r\nquizBtnsHandler();\r\nprogressBarHandler();\r\ntooltipsHandler();\r\n/* ============== */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* ===LIBRARIES=== */\r\nvar quizAreaRange = document.querySelector('.quiz__area-range');\r\nnoUiSlider.create(quizAreaRange, {\r\n    start: 25,\r\n    connect: 'lower',\r\n    tooltips: true,\r\n    format: {\r\n        to: function (value) {\r\n            return parseInt(value);\r\n        },\r\n        from: function (value) {\r\n            return parseInt(value);\r\n        }\r\n    },\r\n    step: 1,\r\n    range: {\r\n        'min': 10,\r\n        'max': 120\r\n    }\r\n});\r\nvar quizFloorRange = document.querySelector('.quiz__floor-range');\r\nnoUiSlider.create(quizFloorRange, {\r\n    start: 5,\r\n    connect: 'lower',\r\n    tooltips: true,\r\n    format: {\r\n        to: function (value) {\r\n            return parseInt(value);\r\n        },\r\n        from: function (value) {\r\n            return parseInt(value);\r\n        }\r\n    },\r\n    step: 1,\r\n    range: {\r\n        'min': 1,\r\n        'max': 20\r\n    }\r\n});\r\ndocument.querySelector('#imaskScript').onload = function() {\r\n    var phoneInput = document.querySelector('.quiz__confirm-input');\r\n    var maskOptions = {\r\n      mask: '+{7}(000)000-00-00',\r\n      lazy: false,\r\n      placeholderChar: '  ',\r\n    };\r\n    var mask = IMask(phoneInput, maskOptions);\r\n};\r\nquizAreaRange.noUiSlider.on('update', function() {\r\n    areaInput.value = quizAreaRange.noUiSlider.get();\r\n});\r\nquizFloorRange.noUiSlider.on('update', function() {\r\n    floorInput.value = quizFloorRange.noUiSlider.get();\r\n});\r\nareaInput.onchange = function() {\r\n    quizAreaRange.noUiSlider.set(+areaInput.value);\r\n};\r\nfloorInput.onchange = function() {\r\n    quizFloorRange.noUiSlider.set(+floorInput.value);\r\n};"],"file":"../main.min.js"}