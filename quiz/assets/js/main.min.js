var quiz = document.querySelector('#quiz');
var closeBtn = document.querySelector('.quiz__close');
var roomsItems = document.querySelectorAll('.quiz__rooms-item');
var roomsImgs = document.querySelectorAll('.quiz__rooms-img');
var roomsRadio = document.querySelectorAll('input[name="rooms"]');
var regionRadio = document.querySelectorAll('.quiz__region-radio');
var regionItems = document.querySelectorAll('.quiz__region-item');
var renovatedRadio = document.querySelectorAll('.quiz__renovated-radio');
var renovatedItems = document.querySelectorAll('.quiz__renovated-item');
var btnsCallQuiz = document.querySelectorAll('[data-call-popup]');
var tooltipElem = document.querySelector('.quiz__tooltip');
var contents = document.querySelectorAll('.quiz__content');
var main = document.querySelector('.quiz__main');
var sidebar = document.querySelector('.quiz__sidebar');

var confirmWindow = document.querySelector('.quiz__confirm');

// document.querySelector('.quiz__confirm').style.display = 'none';

/* ===DATA=== */
var controls = {
    tooltip: document.querySelector('.quiz__tooltip'),
    progressBar: document.querySelector('.quiz__progress'),
    progressItems: document.querySelectorAll('.quiz__progress-item'),
    btnPrev: document.querySelector('.quiz__btn--prev'),
    btnNext: document.querySelector('.quiz__btn--next'),
    currentPage: 0,
};
var tooltips = [
    'Выберите подходящий ответ, нажав на него',
    'Пожалуйста, воспользуйтесь ползунком для этого. Если не знаете точно - укажите примерную площадь. Точную площадь вы можете узнать в паспорте квартиры или в платёжке ЖКХ',
    'Выберите подходящий ответ, нажав на него',
    'Пожалуйста, воспользуйтесь ползунком для этого',
    'Выберите подходящий ответ, нажав на него'
];
var quizData = {
    
};
/* ========== */







/* ===FUNCTIONS=== */
function showPopup(selector) {
    var popup = document.querySelector(selector);
    popup.classList.add('shown');
}
function hidePopup(selector) {
    var popup = document.querySelector(selector);
    popup.classList.remove('shown');
}
function roomsImgBg() {
    for (var i = 0; i < roomsItems.length; i++) {
        var url = roomsImgs[i].src;
        roomsItems[i].style.backgroundImage = 'url(' + url + ')';
    }
}
function radioHandler(itemList, radioList, afterSelect = null) {
    for (var i = 0; i < itemList.length; i++) {
        var select = selectRadio.bind(null, i);
        var handler = selectItem.bind(null, i);
        itemList[i].addEventListener('click', select);
        itemList[i].addEventListener('change', handler);
    }
    function selectItem(ind) {
        for (var j = 0; j < itemList.length; j++) {
            itemList[j].classList.remove('checked');
        }
        // handleRadioValue(radioList[ind]);
        itemList[ind].classList.add('checked');
        if (afterSelect) {afterSelect();}
    }
    function selectRadio(ind) {
        radioList[ind].checked = true;
        selectItem(ind);
    }
}
function quizBtnsHandler() {
    if (controls.currentPage === 0) {
        controls.btnPrev.setAttribute('disabled', 'disabled');
    } else {
        controls.btnPrev.removeAttribute('disabled');
    }
    // if (controls.currentPage === contents.length - 1) {
    //     controls.btnNext.textContent = 'последний шаг';
    // } else {
    //     controls.btnNext.textContent = 'далее';
    // }
}
function nextSlide() {
    if (controls.currentPage < contents.length - 1) {
        contents[controls.currentPage].classList.add('hidden');
        contents[++controls.currentPage].classList.remove('hidden');
    } else if (controls.currentPage === contents.length - 1) {
        showFinalForm();
    }
    quizBtnsHandler();
    progressBarHandler();
    tooltipsHandler();
    quizHandleValues();
}
function prevSlide() {
    if (controls.currentPage > 0) {
        contents[controls.currentPage].classList.add('hidden');
        contents[--controls.currentPage].classList.remove('hidden');
    }
    quizBtnsHandler();
    progressBarHandler();
    tooltipsHandler();
}
function progressBarHandler() {
    for (var i = 0; i < controls.progressItems.length; i++) {
        controls.progressItems[i].classList.remove('checked');
    }
    for (var i = 0; i < controls.currentPage+1; i++) {
        controls.progressItems[i].classList.add('checked');
    }
}
function tooltipsHandler() {
    var text = tooltips[controls.currentPage];
    var textArr = text.split(' ');
    var resultText = '';
    var prevText = '';
    if (window.innerWidth < 480) {
        for (var i = 0; i < textArr.length; i++) {
            prevText = resultText;
            resultText += textArr[i] + ' ';
            tooltipElem.innerHTML = '';
            var span = document.createElement('span');
            span.textContent = resultText;
            tooltipElem.appendChild(span);
            if (span.getClientRects().length >= 3) {
                tooltipElem.textContent = prevText;
                break;
            }
        }
    }
    // console.log(span.getClientRects().length);

}
function showFinalForm() {
    for (var i = 0; i < contents.length; i++) {
        contents[i].classList.add('hidden');
    }
    confirmWindow.classList.remove('hidden');
    main.classList.add('hidden');
    sidebar.classList.add('hidden');
}
function handleRadioValue(input) {
    quizData[input.name] = input.value;
}
function quizHandleValues() {
    var rooms = null;
    var region = null;
    var renovated = null;
    for (var i = 0; i < roomsRadio.length; i++) {
        if (roomsRadio[i].checked) {
            rooms = roomsRadio[i].value;
        }
    }
    for (var i = 0; i < regionRadio.length; i++) {
        if (regionRadio[i].checked) {
            region = regionRadio[i].value;
        }
    }
    for (var i = 0; i < renovatedRadio.length; i++) {
        if (renovatedRadio[i].checked) {
            renovated = renovatedRadio[i].value;
        }
    }

    quizData.rooms = rooms;
    quizData.region = region;
    quizData.renovated = renovated;
    quizData.area = quizAreaRange.noUiSlider.get();
    quizData.floor = quizFloorRange.noUiSlider.get();
    console.log(quizData);
}
/* =============== */







/* ===HANDLERS=== */
for (var i = 0; i < btnsCallQuiz.length; i++) {
    var show = showPopup.bind(null, btnsCallQuiz[i].getAttribute('data-call-popup'));
    btnsCallQuiz[i].addEventListener('click', show);
}
quiz.addEventListener('mousedown', function(e) {
    if (e.target === quiz || e.target === closeBtn) {
        hidePopup('#' + quiz.id);
    }
});
radioHandler(roomsItems, roomsRadio, nextSlide);
radioHandler(regionItems, regionRadio);
radioHandler(renovatedItems, renovatedRadio);
roomsImgBg();

controls.btnNext.addEventListener('click', nextSlide);
controls.btnPrev.addEventListener('click', prevSlide);
quizBtnsHandler();
progressBarHandler();
tooltipsHandler();
/* ============== */









/* ===LIBRARIES=== */
var quizAreaRange = document.querySelector('.quiz__area-range');
noUiSlider.create(quizAreaRange, {
    start: 25,
    connect: 'lower',
    tooltips: true,
    format: {
        to: function (value) {
            return parseInt(value);
        },
        from: function (value) {
            return parseInt(value);
        }
    },
    step: 1,
    range: {
        'min': 10,
        'max': 120
    }
});
var quizFloorRange = document.querySelector('.quiz__floor-range');
noUiSlider.create(quizFloorRange, {
    start: 5,
    connect: 'lower',
    tooltips: true,
    format: {
        to: function (value) {
            return parseInt(value);
        },
        from: function (value) {
            return parseInt(value);
        }
    },
    step: 1,
    range: {
        'min': 1,
        'max': 20
    }
});
document.querySelector('#imaskScript').onload = function() {
    var phoneInput = document.querySelector('.quiz__confirm-input');
    var maskOptions = {
      mask: '+{7}(000)000-00-00',
      lazy: false
    };
    var mask = IMask(phoneInput, maskOptions);
};


//# sourceMappingURL=maps/main.min.js.map
