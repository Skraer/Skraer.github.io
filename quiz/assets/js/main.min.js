var quiz = document.querySelector('#quiz');
var closeBtn = document.querySelector('.quiz__close');
var roomsItems = document.querySelectorAll('.quiz__rooms-item');
var roomsImgs = document.querySelectorAll('.quiz__rooms-img');
var roomsRadio = document.querySelectorAll('input[name="rooms"]');
var regionRadio = document.querySelectorAll('.quiz__region-radio');
var regionItems = document.querySelectorAll('.quiz__region-item');
var renovatedRadio = document.querySelectorAll('.quiz__renovated-radio');
var renovatedItems = document.querySelectorAll('.quiz__renovated-item');
var btnsCallQuiz = document.querySelectorAll('[data-call-popup]');
var tooltipElem = document.querySelector('.quiz__tooltip');
var contents = document.querySelectorAll('.quiz__content');
var main = document.querySelector('.quiz__main');
var sidebar = document.querySelector('.quiz__sidebar');
var confirmWindow = document.querySelector('.quiz__confirm');
var successWindow = document.querySelector('.quiz__success');
var submitBtn = document.querySelector('.quiz__confirm-btn');
var areaInput = document.querySelector('.quiz__area-input input');
var floorInput = document.querySelector('.quiz__floor-input input');

submitBtn.addEventListener('click', function(e) {
    e.preventDefault();
    confirmWindow.classList.add('hidden');
    successWindow.classList.remove('hidden');
    document.querySelector('.quiz__inner').classList.add('autoheight');

    // sendForm();
});

/* ===DATA=== */
var controls = {
    // tooltip: document.querySelector('.quiz__tooltip'),
    progressBar: document.querySelector('.quiz__progress'),
    progressItems: document.querySelectorAll('.quiz__progress-item'),
    btnPrev: document.querySelector('.quiz__btn--prev'),
    btnNext: document.querySelector('.quiz__btn--next'),
    currentPage: 0,
};

var tooltips = [
    'Выберите подходящий ответ, нажав на него',
    'Пожалуйста, воспользуйтесь ползунком для этого. Если не знаете точно - укажите примерную площадь. Точную площадь вы можете узнать в паспорте квартиры или в платёжке ЖКХ',
    'Выберите подходящий ответ, нажав на него',
    'Пожалуйста, воспользуйтесь ползунком для этого',
    'Выберите подходящий ответ, нажав на него'
];
var quizData = {
    
};
/* ========== */







/* ===FUNCTIONS=== */
function showPopup(selector) {
    var popup = document.querySelector(selector);
    popup.classList.add('shown');
}
function hidePopup(selector) {
    var popup = document.querySelector(selector);
    popup.classList.remove('shown');
}
function roomsImgBg() {
    for (var i = 0; i < roomsItems.length; i++) {
        var url = roomsImgs[i].src;
        roomsItems[i].style.backgroundImage = 'url(' + url + ')';
    }
}
function radioHandler(itemList, radioList, afterSelect = null) {
    for (var i = 0; i < itemList.length; i++) {
        var select = selectRadio.bind(null, i);
        var handler = selectItem.bind(null, i);
        itemList[i].addEventListener('click', select);
        itemList[i].addEventListener('change', handler);
    }
    function selectItem(ind) {
        for (var j = 0; j < itemList.length; j++) {
            itemList[j].classList.remove('checked');
        }
        itemList[ind].classList.add('checked');
        if (afterSelect) {afterSelect();}
    }
    function selectRadio(ind) {
        radioList[ind].checked = true;
        selectItem(ind);
    }
}
function quizBtnsHandler() {
    if (controls.currentPage === 0) {
        controls.btnPrev.setAttribute('disabled', 'disabled');
    } else {
        controls.btnPrev.removeAttribute('disabled');
    }
    if (window.innerWidth > 480) {
        if (controls.currentPage === contents.length - 1) {
            controls.btnNext.textContent = 'последний шаг';
        } else {
            controls.btnNext.textContent = 'далее';
        }
    }
}
function nextSlide() {
    var radios = contents[controls.currentPage].querySelectorAll('input[type="radio"]');
    var title = contents[controls.currentPage].querySelector('.quiz__title');
    var allow = false;
    if (radios.length > 0) {
        for (var k = 0; k < radios.length; k++) {
            if (radios[k].checked) {allow = true;}
        }
    } else {allow = true;}
    if (controls.currentPage < contents.length - 1 && allow) {
        title.classList.remove('not-allow');
        contents[controls.currentPage].classList.add('hidden');
        contents[++controls.currentPage].classList.remove('hidden');
    } else if (controls.currentPage === contents.length - 1 && allow) {
        title.classList.remove('not-allow');
        showFinalForm();
    } else {
        title.classList.remove('not-allow');
        title.classList.add('not-allow');
        title.onanimationend = function() {title.classList.remove('not-allow');};
    }
    quizBtnsHandler();
    progressBarHandler();
    tooltipsHandler();
    quizHandleValues();
}
function prevSlide() {
    if (controls.currentPage > 0) {
        contents[controls.currentPage].classList.add('hidden');
        contents[--controls.currentPage].classList.remove('hidden');
    }
    quizBtnsHandler();
    progressBarHandler();
    tooltipsHandler();
}
function progressBarHandler() {
    for (var i = 0; i < controls.progressItems.length; i++) {
        controls.progressItems[i].classList.remove('checked');
    }
    for (var i = 0; i < controls.currentPage+1; i++) {
        controls.progressItems[i].classList.add('checked');
    }
}
function tooltipsHandler() {
    var text = tooltips[controls.currentPage];
    var textArr = text.split(' ');
    var resultText = '';
    // var prevText = '';

    if (window.innerWidth < 767) {
        var span = document.createElement('span');
        for (var i = 0; i < textArr.length; i++) {
            resultText += textArr[i] + ' ';
            tooltipElem.innerHTML = '';
            span.textContent = resultText;
            tooltipElem.appendChild(span);
            if (span.getClientRects().length >= 3) {
                var cuttedText = textArr.slice(0, i - 1).join(' ') + ' ...';
                span.textContent = cuttedText;
                tooltipElem.appendChild(span);
                tooltipElem.classList.add('closed');
                tooltipElem.setAttribute('data-cutted-text', cuttedText);
                break;
            } else {
                tooltipElem.classList.remove('closed');
                tooltipElem.classList.remove('opened');
                tooltipElem.removeAttribute('data-cutted-text');
            }
        }
    } else {
        tooltipElem.textContent = tooltips[controls.currentPage];
    }
}
function showFinalForm() {
    for (var i = 0; i < contents.length; i++) {
        contents[i].classList.add('hidden');
    }
    confirmWindow.classList.remove('hidden');
    main.classList.add('hidden');
    sidebar.classList.add('hidden');
}
function handleRadioValue(input) {
    quizData[input.name] = input.value;
}
function quizHandleValues() {
    var rooms = null;
    var region = null;
    var renovated = null;
    for (var i = 0; i < roomsRadio.length; i++) {
        if (roomsRadio[i].checked) {
            rooms = roomsRadio[i].value;
        }
    }
    for (var i = 0; i < regionRadio.length; i++) {
        if (regionRadio[i].checked) {
            region = regionRadio[i].value;
        }
    }
    for (var i = 0; i < renovatedRadio.length; i++) {
        if (renovatedRadio[i].checked) {
            renovated = renovatedRadio[i].value;
        }
    }

    quizData.rooms = rooms;
    quizData.region = region;
    quizData.renovated = renovated;
    quizData.area = quizAreaRange.noUiSlider.get();
    quizData.floor = quizFloorRange.noUiSlider.get();
    console.log(quizData);
}
function openOrCloseTooltip() {
    var sidebarHeight = parseInt(sidebar.getBoundingClientRect().height) + 'px';
    if (tooltipElem.classList.contains('closed')) {
        sidebar.style.height = sidebarHeight;
        tooltipElem.classList.remove('closed');
        tooltipElem.classList.add('opened');
        tooltipElem.firstElementChild.textContent = tooltips[controls.currentPage];
    } else if (tooltipElem.classList.contains('opened')) {
        sidebar.style.height = '';
        tooltipElem.classList.remove('opened');
        tooltipElem.classList.add('closed');
        tooltipElem.firstElementChild.textContent = tooltipElem.getAttribute('data-cutted-text');
    }
}
function sendForm(e) {
    
}
/* =============== */







/* ===HANDLERS=== */
for (var i = 0; i < btnsCallQuiz.length; i++) {
    var show = showPopup.bind(null, btnsCallQuiz[i].getAttribute('data-call-popup'));
    btnsCallQuiz[i].addEventListener('click', show);
}
quiz.addEventListener('mousedown', function(e) {
    if (e.target === quiz || e.target === closeBtn) {
        hidePopup('#' + quiz.id);
    }
});
tooltipElem.addEventListener('click', openOrCloseTooltip);
radioHandler(roomsItems, roomsRadio, nextSlide);
radioHandler(regionItems, regionRadio, nextSlide);
radioHandler(renovatedItems, renovatedRadio, nextSlide);
roomsImgBg();

controls.btnNext.addEventListener('click', nextSlide);
controls.btnPrev.addEventListener('click', prevSlide);
quizBtnsHandler();
progressBarHandler();
tooltipsHandler();
/* ============== */









/* ===LIBRARIES=== */
var quizAreaRange = document.querySelector('.quiz__area-range');
noUiSlider.create(quizAreaRange, {
    start: 25,
    connect: 'lower',
    tooltips: true,
    format: {
        to: function (value) {
            return parseInt(value);
        },
        from: function (value) {
            return parseInt(value);
        }
    },
    step: 1,
    range: {
        'min': 10,
        'max': 120
    }
});
var quizFloorRange = document.querySelector('.quiz__floor-range');
noUiSlider.create(quizFloorRange, {
    start: 5,
    connect: 'lower',
    tooltips: true,
    format: {
        to: function (value) {
            return parseInt(value);
        },
        from: function (value) {
            return parseInt(value);
        }
    },
    step: 1,
    range: {
        'min': 1,
        'max': 20
    }
});
document.querySelector('#imaskScript').onload = function() {
    var phoneInput = document.querySelector('.quiz__confirm-input');
    var maskOptions = {
      mask: '+{7}(000)000-00-00',
      lazy: false,
      placeholderChar: '  ',
    };
    var mask = IMask(phoneInput, maskOptions);
};
quizAreaRange.noUiSlider.on('update', function() {
    areaInput.value = quizAreaRange.noUiSlider.get();
});
quizFloorRange.noUiSlider.on('update', function() {
    floorInput.value = quizFloorRange.noUiSlider.get();
});
areaInput.onchange = function() {
    quizAreaRange.noUiSlider.set(+areaInput.value);
};
floorInput.onchange = function() {
    quizFloorRange.noUiSlider.set(+floorInput.value);
};
//# sourceMappingURL=maps/main.min.js.map
